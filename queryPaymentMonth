select d.id, d.description, m.description as metodo_pgto, b.name as banco, d.purchase_date  as data_aquisicao, 
d.installments_number, d.due_date, d.amount, pgto.amount_paid, d.shared, s.description as status, pgto.month, pgto.year, 
pgto.amount_consumed, (d.amount - pgto.amount_consumed) as valor_restante 
from expenses d left join payments pgto on d.id = pgto.expense_id
left join payment_methods m on d.payment_method_id= m.id 
left join banks b on d.bank_id = b.id 
left join status_expense s on d.status_id = s.id 
where d.active = true 
and d.purchase_date < '2019-10-18 21:28:57.672+00'
and (
( s.description = 'Aberto') or 
(s.description = 'Recorrente') or 
(s.description = 'Fechado' and pgto.month = 4 and pgto.year = 2019)
)
ORDER BY d.ID ASC

